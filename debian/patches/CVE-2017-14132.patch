From: Markus Koschany <apo@debian.org>
Date: Mon, 19 Nov 2018 19:49:10 +0100
Subject: CVE-2017-14132

To ensure the reported heap-overflow does not occur, this patch returns an
error when maxcmpts in the jas_image_growcmpts() function is less than or equal
to 0. There might be more affected functions but since upstream have not
commented on CVE-2017-14132, this is the best solution we have got.

Bug-Upstream: https://github.com/mdadams/jasper/issues/147
---
 src/libjasper/base/jas_image.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/src/libjasper/base/jas_image.c b/src/libjasper/base/jas_image.c
index 0ccfb44..ca1bd9a 100644
--- a/src/libjasper/base/jas_image.c
+++ b/src/libjasper/base/jas_image.c
@@ -790,6 +790,9 @@ static void jas_image_setbbox(jas_image_t *image)
 
 static int jas_image_growcmpts(jas_image_t *image, int maxcmpts)
 {
+	if (maxcmpts <= 0) {
+		return -1;
+	}
 	jas_image_cmpt_t **newcmpts;
 	int cmptno;
 
